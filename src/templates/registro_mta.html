{% extends 'base_navbar.html' %}


{% block title %}Cotecmar || Registro del MTA{% endblock %}

{% block custom %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/registro_mta.css') }}">
{% endblock %}

{% block nombre %}Registro del MTA - LORA{% endblock %}

{% block content %}
        <!-- Contenido principal -->
        <div class="col">
            <h2 class="section-title text-center">Maintenance Task Analysis (MTA)</h2>
            <br>
            <form id="mta-form" method="POST" action="{{ url_for('guardar_MTA', fmea_id=fmea['id']) }}">
                <div class="row">
                    <div class="col-md-4">
                        <label for="sistema" class="form-label">Sistema</label>
                        <input type="text" id="sistema" class="form-control" name="sistema" value="{{ fmea['sistema'] | default('') }}" readonly>

                        <label for="tipo_mantenimiento" class="form-label">Tipo de mantenimiento</label>
                        <select class="form-control" id="tipo_mantenimiento" name="tipo_mantenimiento">
                            <option value="" disabled selected>---- Selecciona ----</option>
                            {% for tipo in tipo_de_manteniemto %}
                                <option value="{{ tipo['id'] }}">{{ tipo['nombre'] }}</option>
                            {% endfor %}
                        </select>

                    </div>    
                    <div class="col-md-4">
                        <label for="componente" class="form-label">Componente</label>
                        <input type="text" id="componente" class="form-control" name="componente" value="{{ fmea['componente'] | default('') }}" readonly>

                        <label for="tarea_mantenimiento" class="form-label">Tarea de mantenimiento</label>
                        <select class="form-control" id="tarea_mantenimiento" name="tarea_mantenimiento">
                            <option value="" disabled selected>---- Selecciona ----</option>
                            {% for tarea in tarea_mantenimento %}
                                <option value="{{ tarea['id'] }}">{{ tarea['nombre'] }}</option>
                            {% endfor %}
                        </select>  
                    </div>
                    <div class="col-md-4">
                        <label for="falla_funcional" class="form-label">Falla Funcional</label>
                        <input type="text" id="falla_funcional" class="form-control" name="falla_funcional" value="{{ fmea['falla_funcional'] }}" readonly>

                        <label for="personal_requerido" class="form-label">Cantidad de personal requerido</label>
                        <input type="number" id="personal_requerido" class="form-control">
                    </div>
                    
                    
                    <!-- Herramientas / Equipos Requeridos -->
                    <h4 class="section-title text-center my-4">HERRAMIENTAS / EQUIPOS REQUERIDOS</h4>
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        {% for key in herramientas_por_tipo %}
                        {% set key_sin_espacios = key.replace(' ', '') %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="{{ key_sin_espacios + '-tab' }}" data-bs-toggle="tab" data-bs-target="#{{ key_sin_espacios }}" type="button" role="tab" aria-controls="{{ key_sin_espacios }}" aria-selected="true">{{ key }}</button>
                        </li>
                        {% endfor %}
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        {% for key in herramientas_por_tipo %}
                        {% set key_sin_espacios = key.replace(' ', '') %}
                        <div class="tab-pane fade show" id="{{ key_sin_espacios }}" role="tabpanel" aria-labelledby="{{ key_sin_espacios }}-tab">
                            <br>
                            {% for herramienta in herramientas_por_tipo[key] %}
                                {% if loop.index0 % 3 == 0 %}
                                    <div class="row">
                                {% endif %}
                                <div class="col-md-4 form-check">
                                    <input type="checkbox" class="form-check-input" id="{{ herramienta['id_tipo_herramienta'] }}" value = "{{ herramienta['id_tipo_herramienta'] }}">
                                    <label for="{{ herramienta.id }}" class="form-check-label">{{ herramienta.nombre }}</label>
                                </div>
                                {% if loop.index0 % 3 == 2 or loop.last %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                    <!-- Fin Herramientas / Equipos Requeridos -->
                    
                    <!-- Primera columna -->
                    <div class="col-md-4 my-4">
                        <label for="consumibles" class="form-label">Consumibles requeridos</label>
                        <input type="text" class="form-control" id="consumibles" name="consumibles">
                        
                        <label for="repuestos" class="form-label">Repuestos requeridos (referenciado del manual)</label>
                        <input type="text" class="form-control" id="repuestos" name="repuestos">
                        
                        <label for="requeridos_tarea" class="form-label">Requeridos por Tarea</label>
                        <input type="text" class="form-control" id="requeridos_tarea" name="requeridos_tarea">
                    </div>

                    <!-- Segunda columna -->
                    <div class="col-md-4 my-4">
                        <label for="ambientales" class="form-label">Condiciones Requeridas (Ambientales)</label>
                        <input type="text" class="form-control" id="ambientales" name="ambientales">
                        
                        <label for="estado_equipo" class="form-label">Condiciones Requeridas (Estado del equipo)</label>
                        <select class="form-control" id="estado_equipo" name="estado_equipo">
                            <option value="" disabled selected>---- Selecciona ----</option>
                            <option value="Apagado">Apagado</option>
                            <option value="Apagado sin alimentacion">Apagado sin alimentación</option>
                            <option value="Funcionando">Funcionando</option>
                        </select>
                        
                        <label for="especiales" class="form-label">Condiciones Requeridas (Especiales)</label>
                        <input type="text" class="form-control" id="especiales" name="especiales">
                    </div>

                    <!-- Tercera columna -->
                    <div class="col-md-4 my-4">
                        <label for="horas" class="form-label">Duración de la Tarea (Horas)</label>
                        <input type="number" class="form-control" id="horas" name="horas">
                        
                        <label for="minutos" class="form-label">Duración de la Tarea (Minutos)</label>
                        <input type="number" class="form-control" id="minutos" name="minutos">
                        
                        <label for="detalle_tarea" class="form-label">Detalle de tarea</label>
                        <input type="text" class="form-control" id="detalle_tarea" name="detalle_tarea">
                    </div>

                    <h2 class="section-title text-center">Level Of Repair Analysis (LORA)</h2>

                    <div class="mt-3 popup">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" id="startQuizBtn">
                            Realizar Cuestionario LORA
                        </button>
                        
                        <!-- El Modal (popup) -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Cuestionario LORA</h5>
                                        <button id="startQuizBtn" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body text-center">
                                        <label id="questionText" class="d-block mb-3"></label>
                                        <div id="answers">
                                            <!-- Los botones "Sí" y "No" -->
                                            <button type="button" class="btn btn-primary me-2" id="yesBtn">Sí</button>
                                            <button type="button" class="btn btn-primary" id="noBtn">No</button>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <br><br>
                                        <button type="button" class="btn btn-secondary" id="backBtn"><i class="bi bi-arrow-left-circle-fill"></i></button>
                                    </div>                             
                                </div>
                            </div>
                        </div>
                        
                    </div>

                    <table class="table mt-3">
                        <thead>
                          <tr>
                            <th scope="col">Nivel</th>
                            <th scope="col">Actividades</th>
                            <th scope="col">Operario</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>Mark</td>
                            <td>Otto</td>
                            <td>@mdo</td>
                          </tr>
                          <tr>
                            <td>Jacob</td>
                            <td>tdornton</td>
                            <td>@fat</td>
                          </tr>
                          <tr>
                            <td colspan="2">Larry tde Bird</td>
                            <td>@twitter</td>
                            
                          </tr>
                        </tbody>
                      </table>

                    <!-- Botón siguiente -->
                    <div class="text-end mt-4">
                        <button type="submit" class="btn btn-siguiente" id="btn-siguiente">Guardar MTA</button>
                    </div>
                </div>    
            </form>
        </div>
    </div>
</div>
<script>
document.getElementById('mta-form').addEventListener('submit', function(event) {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
    const selectedValues = Array.from(checkboxes).map(cb => cb.value);
    const hiddenField = document.createElement('input');
    hiddenField.type = 'hidden';
    hiddenField.name = 'selected_herramientas';
    hiddenField.value = JSON.stringify(selectedValues);
    this.appendChild(hiddenField);
});
</script>
<script src="{{ url_for('static', filename='js/cuestionario_lora.js') }}"></script>
<script src="{{ url_for('static', filename='js/registro_mta.js') }}"></script>

{% endblock %}
