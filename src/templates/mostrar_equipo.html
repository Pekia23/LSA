{% extends './base_navbar_mostrar.html' %}

{% block title %}Cotecmar || Información del Equipo{% endblock %}

{% block custom %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/mostrar_equipo.css') }}">
{% endblock %}

{% block nombre %}LSA | Información del equipo {% endblock %}

{% block content %}
<div class="text-end">
    <a href="{{ url_for('editar_equipo') }}" class="btn btn-primary">Editar</a>
    <button id="btn-eliminar-equipo" class="btn btn-danger">Eliminar</button>
</div>

{% if equipo.imagen %}
<img src="data:image/png;base64,{{ equipo.imagen|b64encode }}" class="imagen" style="float: right;" >
{% else %}
<img src="{{ url_for('static', filename='img/imagen.jpg') }}" class="imagen" style="float: right;" >
{% endif %}

<div class="imagens">
  <h2>{{ equipo.nombre_equipo }}</h2>
</div>
<br>
<h3>Generalidades</h3>
<form>
  <div class="row">
    <div class="col-md-6 section1">
      <div class="mb-3">
        <label><b>Fecha:</b></label>
        <span>{{ equipo.fecha }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>Grupo constructivo:</b></label>
        <span>{{ equipo.grupo_constructivo }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>Subgrupo constructivo:</b></label>
        <span>{{ equipo.subgrupo_constructivo }}</span>
      </div>
  
      <div class="mb-3">
        <label><b>Sistema:</b></label>
        <span>{{ equipo.sistema }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>Tipo de equipo:</b></label>
        <span>{{ equipo.tipo_equipo }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>Equipo:</b></label>
        <span>{{ equipo.equipo }}</span>
      </div>
    </div>

    <div class="col-md-6 section2">
      <div class="mb-3">
        <label><b>Responsable:</b></label>
        <span>{{ equipo.responsable }}</span>
      </div>

      <div class="mb-3">
        <label><b>Criticidad de sistema:</b></label>
        <span>{{ equipo.criticidad_equipo }}</span>
      </div>

      <div class="mb-3">
        <label><b>Fiabilidad del sistema:</b></label>
        <span>{{ equipo.fiabilidad_equipo }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>MTBF:</b></label>
        <span>{{ equipo.MTBF }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>AOR:</b></label>
        <span>{{ equipo.AOR }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>GRES:</b></label>
        <span>{{ equipo.GRES }}</span>
      </div>
    </div>
  </div>
</form>
<br>
<h3>Contexto Operacional</h3>
<form>
  <div class="row">
    <div class="col-md-6 section1">
      <div class="mb-3">
        <label><b>Peso:</b></label>
        <span>{{ equipo.peso_seco }}</span>
      </div>
      
      <div class="mb-3">
        <label><b>Dimensiones:</b></label>
        <span>{{ equipo.dimensiones }}</span>
      </div>
    </div>

    <div class="col-md-6 section2">
      <div class="mb-3">
        <label><b>Marca:</b></label>
        <span>{{ equipo.marca }}</span>
      </div>

      <div class="mb-3">
        <label><b>Modelo:</b></label>
        <span>{{ equipo.modelo }}</span>
      </div>
    </div>
  </div>
</form>
<br>
<h3>Descripción del Equipo</h3>
<p>
  {{ equipo.descripcion }}
</p>
<br>
<h3>Diagrama de Flujo del Subsistema Ubicado en el Equipo</h3>
{% if diagrama.diagrama_fijo %}
<img src="data:image/png;base64,{{ diagrama.diagrama_fijo|b64encode }}" class="imagend">
{% else %}
<img src="{{ url_for('static', filename='img/prueba.jpg') }}" class="imagend">
{% endif %}
<br>
<h3>Diagrama Caja Negra de la Función</h3>
{% if diagrama.diagrama_caja_negra %}
<img src="data:image/png;base64,{{ diagrama.diagrama_caja_negra|b64encode }}" class="imagend">
{% else %}
<img src="{{ url_for('static', filename='img/prueba2.jpg') }}" class="imagend">
{% endif %}
<br>
<h3>Diagrama de Caja Transparente</h3>
{% if diagrama.diagrama_caja_transparente %}
<img src="data:image/png;base64,{{ diagrama.diagrama_caja_transparente|b64encode }}" class="imagend">
{% else %}
<img src="{{ url_for('static', filename='img/prueba3.jpg') }}" class="imagend">
{% endif %}
<br>
<h3>Procedimiento de Arranque</h3>
<p>
  {{ equipo.procedimiento_arranque }}
</p>
<br>
<h3>Procedimiento de Parada</h3>
<p>
  {{ equipo.procedimiento_parada }}
</p>
<br>
<!-- Script para manejar la eliminación del equipo -->
<script>
  document.getElementById('btn-eliminar-equipo').addEventListener('click', function() {
    if (confirm('¿Estás seguro de que deseas eliminar este equipo?')) {
      fetch('/LSA/eliminar-equipo', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          
        },
        body: JSON.stringify({})
      })
      .then(response => response.json())
      .then(result => {
        if (result.message) {
          alert(result.message);
          window.location.href = '/LSA/registro-generalidades';
        } else {
          alert('Error al eliminar equipo');
        }
      })
      .catch(error => {
        console.error('Error al eliminar equipo:', error);
        alert('Error al eliminar equipo: ' + error.message);
      });
    }
  });
</script>
{% endblock %}
